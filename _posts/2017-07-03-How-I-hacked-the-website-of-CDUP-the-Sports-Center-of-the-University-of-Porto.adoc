= How I hacked the website of CDUP, the Sports Center of the University of Porto
:hp-image: https://user-images.githubusercontent.com/3010353/27763388-d780ea64-5e7a-11e7-9cac-06ce7cf78812.png
:published_at: 2017-07-03
:hp-tags: Hack, CDUP,

While checking the gym prices at CDUP, my friend http://diogomoura.me[Diogo Moura] noticed something unusual: a small square on the bottom-left corner that when clicked would display a bar sticking to the bottom of the screen.
I didn't capture a screenshot so I recreated the page in Photoshop:

.Homepage
image::https://user-images.githubusercontent.com/3010353/27763930-21e2bcd6-5e85-11e7-9dcc-24b1acba656f.png[Homepage]

Diogo is a good guy so he stopped there.

I started investigating that bar and noticed it was the http://phpdebugbar.com/[PHP Debug Bar], useful for debugging purposes during development. It contains some tabs with multiple information about everything that happens in the website. One of the features it provides is a list of the latest HTTP requests made by every user on the website:

.Request list
image::https://user-images.githubusercontent.com/3010353/27763875-20fd5b06-5e84-11e7-94c5-23dd2a367abf.png[Request list]

Obviously, this is a big security issue, since I could trace the actions in the website of whoever I wanted. Some of the entries in that list had the text "/login" in the URL field and "POST" in the method field, meaning that they were related to submissions of the administrator login form. By clicking that entry I was able to see all details of that specific request, including the username and the plaintext password that were sent in the body of the request:

....
{  
   "_token":"YVOzlSSYcaEEkPF24AVNke2KsdvEUZedIwNtHyJo",
   "username":"Admin",
   "password":"XXXXXXXXXXXXXXXX"
}
....

So I went to the http://cdup.up.pt/admin[administrator login form] and successfully logged in with the credentials I had just stolen. Now I had access to the backoffice of the whole website and I could manage users, edit content, etc.

.Editing an entry in the backoffice
image::https://user-images.githubusercontent.com/3010353/27763718-f676d36a-5e80-11e7-92df-0266c105e7a9.png[Editing an entry in the backoffice]

The issue was reported to CDUP and was fixed quickly by removing the PHP Debug Bar.
